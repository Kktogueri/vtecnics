<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Prevención - Monegros 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Desert Sands -->
    <!-- Application Structure Plan: Se ha diseñado una aplicación de página única (SPA) con una estructura orientada a tareas y priorizando el uso en dispositivos móviles. La navegación principal se realiza a través de una barra inferior fija, permitiendo un acceso rápido a cuatro secciones clave: 'Inicio', 'Riesgos', 'Protocolos' y 'Contactos'. La sección de 'Inicio' actúa como un panel de control con acceso inmediato a emergencias y al riesgo climático del día. La sección 'Riesgos' permite al trabajador filtrar el contenido según su área de trabajo, mostrando solo la información relevante para él (riesgos, EPIs, métodos de trabajo y prohibiciones). 'Protocolos' organiza la normativa general y los planes de actuación en secciones desplegables para evitar la sobrecarga de información, incluyendo ahora protocolos de equipos específicos. Esta estructura se eligió porque convierte los extensos documentos PDF en una herramienta de consulta rápida y contextual, centrada en las necesidades inmediatas del trabajador en el terreno, en lugar de forzarlo a navegar por la estructura original de los documentos, y ahora con mayor detalle por puesto. Se ha añadido un modal para un asistente de seguridad con LLM, accesible desde la página de inicio, para responder a preguntas directas de los usuarios. Se ha añadido una nueva sección para el Recurso Preventivo. -->
    <!-- Visualization & Content Choices: 
    - **Riesgo por Calor (Inicio):** Objetivo: Informar de un vistazo. Presentación: Un gráfico de tipo 'gauge' (simulado con un gráfico de dona) y una tarjeta de color. Interacción: El color y el texto cambian según el nivel de riesgo, proporcionando una alerta visual inmediata. Justificación: Traduce la tabla del anexo de calor en un indicador visual instantáneo, mucho más eficaz en un entorno de trabajo que leer una tabla. Librería: Chart.js.
    - **Riesgos por Puesto (Sección Riesgos):** Objetivo: Organizar y personalizar la información. Presentación: Un selector/dropdown seguido de tarjetas informativas detalladas (riesgos, EPIs, métodos, prohibiciones). Interacción: El usuario selecciona su puesto y la aplicación filtra dinámicamente la información correspondiente. Justificación: Reduce la complejidad y hace que la información sea directamente aplicable al usuario, aumentando la probabilidad de que se consulte y se siga, ahora con la profundidad solicitada. Método: HTML/CSS/JS.
    - **Protocolos y Normas (Sección Protocolos):** Objetivo: Organizar y detallar. Presentación: Listas y secciones desplegables (acordeones), incluyendo ahora seguridad de equipos específicos. Interacción: El usuario toca un encabezado para ver los detalles. Justificación: Mantiene la interfaz limpia y permite al usuario escanear rápidamente los temas y profundizar solo en el que le interesa, ofreciendo más información sin abrumar. Método: HTML/CSS/JS.
    - **Emergencias (Botón Fijo y Sección Contactos):** Objetivo: Actuar rápidamente. Presentación: Un botón rojo siempre visible y una lista clara de contactos. Interacción: Los números de teléfono son enlaces 'tel:'. Justificación: En una emergencia, el acceso debe ser inmediato y sin ambigüedades. Método: HTML/CSS.
    - **Asistente de Seguridad (Modal):** Objetivo: Proporcionar respuestas rápidas a preguntas de seguridad. Presentación: Interfaz de chat con entrada de texto y historial de mensajes. Interacción: El usuario escribe una pregunta, el LLM responde. Justificación: Ofrece una forma intuitiva y conversacional de obtener información de seguridad sin navegar por documentos. Método: HTML/CSS/JS con Gemini API.
    - **Recurso Preventivo (Nueva Sección):** Objetivo: Detallar el rol y la disponibilidad del Recurso Preventivo. Presentación: Información textual organizada en subsecciones. Interacción: Navegación directa desde la barra inferior. Justificación: Proporciona información clave sobre una figura de seguridad crucial en el evento. Método: HTML/CSS/JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap');
        .active-nav {
            color: #F59E0B; /* amber-500 */
            border-top-color: #F59E0B;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .chat-history {
            max-height: 70vh; /* Adjusted for mobile view */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9fafb; /* light gray */
        }
        .chat-message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        .chat-message.user {
            background-color: #dbeafe; /* blue-100 */
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .chat-message.ai {
            background-color: #e0f2fe; /* lightblue-100 */
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div id="app-container" class="pb-20">
        
        <header class="bg-black text-white p-4 shadow-md sticky top-0 z-10">
            <div class="container mx-auto flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold">MONEGROS 2025</h1>
                    <p class="text-sm text-amber-400">Guía Rápida de Prevención</p>
                </div>
                 <div class="text-center">
                    <span class="text-2xl">👷</span>
                </div>
            </div>
        </header>

        <main id="main-content" class="p-4 container mx-auto">
            
            <section id="inicio" class="content-section active">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6 text-center">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Panel de Control</h2>
                    <p class="text-stone-600">Accede a la información clave para tu seguridad durante el montaje.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-3 text-center text-red-700">🚨 Riesgo Climático Hoy</h3>
                        <div id="heat-risk-container" class="p-4 rounded-lg text-white text-center flex flex-col items-center">
                            <div class="chart-container w-full max-w-[250px] mx-auto h-[150px] relative">
                                <canvas id="heatRiskChart"></canvas>
                                <div id="heat-level-text" class="absolute inset-0 flex items-center justify-center text-3xl font-extrabold"></div>
                            </div>
                            <p id="heat-risk-level" class="text-2xl font-bold mt-2"></p>
                            <p id="heat-risk-description" class="mt-1 font-medium"></p>
                        </div>
                         <div class="mt-4 text-sm text-stone-600">
                            <p><strong class="text-stone-800">Medidas Clave:</strong></p>
                            <ul id="heat-recommendations" class="list-disc list-inside mt-2 space-y-1">
                                <li>Bebe agua frecuentemente.</li>
                                <li>Realiza pausas en la sombra.</li>
                                <li>Usa ropa ligera y protección solar.</li>
                                <li>Vigila síntomas de mareo o fatiga.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-md">
                         <h3 class="font-bold text-lg mb-3 text-center">⚡️ Accesos Rápidos</h3>
                         <div class="space-y-3">
                             <button onclick="navigateTo('riesgos')" class="w-full text-left flex items-center bg-stone-200 hover:bg-stone-300 p-4 rounded-lg transition-colors">
                                <span class="text-2xl mr-4">⚠️</span>
                                <div>
                                    <span class="font-bold">Ver Riesgos por Puesto</span>
                                    <span class="block text-sm text-stone-600">Encuentra los riesgos y EPIs para tu trabajo.</span>
                                </div>
                            </button>
                             <button onclick="navigateTo('protocolos')" class="w-full text-left flex items-center bg-stone-200 hover:bg-stone-300 p-4 rounded-lg transition-colors">
                                <span class="text-2xl mr-4">📜</span>
                                <div>
                                    <span class="font-bold">Consultar Protocolos</span>
                                    <span class="block text-sm text-stone-600">Normas generales y plan de emergencia.</span>
                                </div>
                            </button>
                            <button onclick="navigateTo('contactos')" class="w-full text-left flex items-center bg-stone-200 hover:bg-stone-300 p-4 rounded-lg transition-colors">
                                <span class="text-2xl mr-4">📞</span>
                                <div>
                                    <span class="font-bold">Contactos de Emergencia</span>
                                    <span class="block text-sm text-stone-600">Listado de personal clave.</span>
                                </div>
                            </button>
                             <button onclick="showChatbotModal()" class="w-full text-left flex items-center bg-blue-600 text-white hover:bg-blue-700 p-4 rounded-lg transition-colors">
                                <span class="text-2xl mr-4">✨</span>
                                <div>
                                    <span class="font-bold">Asistente de Seguridad IA</span>
                                    <span class="block text-sm text-blue-100">Pregunta al LLM sobre seguridad laboral.</span>
                                </div>
                            </button>
                         </div>
                    </div>
                </div>
            </section>

            <section id="riesgos" class="content-section">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Riesgos y Medidas Preventivas</h2>
                    <p class="text-stone-600">Selecciona tu área de trabajo para ver los riesgos específicos y el equipo de protección individual (EPI) obligatorio.</p>
                </div>
                
                <div class="mb-6">
                    <label for="job-selector" class="block text-sm font-medium text-stone-700 mb-2">Selecciona tu puesto o tarea:</label>
                    <select id="job-selector" class="block w-full p-3 border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                        <option value="general">Visión General</option>
                        <option value="carga">Mozo de Carga y Descarga</option>
                        <option value="altura">Técnico/Montador de Estructuras</option>
                        <option value="soldador">Soldador</option>
                        <option value="maquinaria">Conductor de Carretillas Elevadoras</option>
                        <option value="plataformas">Conductor de Plataformas Elevadoras</option>
                        <option value="riggers">Trabajador Vertical (Riggers/Scaffolders)</option>
                        <option value="electricidad">Técnico/Auxiliar Eléctrico</option>
                        <option value="tecnico_audiovisual">Técnico Audiovisual (Iluminación, Audio y Vídeo)</option>
                        <option value="tecnico_camara">Técnico de Cámara</option>
                        <option value="backliner">Backliner</option>
                        <option value="personal_limpieza">Personal de Limpieza</option>
                        <option value="personal_bares">Personal de Bares</option>
                        <option value="personal_restauracion">Personal de Restauración</option>
                        <option value="movilidad_personal">Movilidad Personal (Bicicletas, Patinetes, Vehículos, etc.)</option>
                    </select>
                </div>

                <div id="risk-display" class="space-y-4">
                </div>
            </section>

            <section id="protocolos" class="content-section">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Protocolos y Normas de Actuación</h2>
                    <p class="text-stone-600">Consulta las normas generales del evento y los procedimientos a seguir en caso de emergencia.</p>
                </div>

                <div id="protocols-list" class="space-y-3">
                </div>
            </section>

            <section id="recurso-preventivo" class="content-section">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Recurso Preventivo (RP)</h2>
                    <p class="text-stone-600">El Recurso Preventivo es una figura clave para garantizar tu seguridad en el puesto de trabajo. Su presencia es necesaria en trabajos con riesgos específicos o cuando la concurrencia de operaciones pueda agravarlos.</p>
                </div>

                <div class="space-y-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">¿Qué es un Recurso Preventivo?</h3>
                        <p class="text-stone-700">Es una persona o equipo designado por la empresa para vigilar el cumplimiento de las actividades preventivas, especialmente en trabajos de alto riesgo o con riesgos agravados por la concurrencia de operaciones. Su objetivo principal es asegurar que las medidas de seguridad se apliquen correctamente y que se trabaje de forma segura.</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">Funciones Clave del RP</h3>
                        <ul class="list-disc list-inside space-y-1 text-stone-700">
                            <li>Vigilar, controlar y hacer cumplir el documento preventivo de la empresa principal.</li>
                            <li>Informar a los trabajadores sobre las medidas de seguridad y obligar al uso de EPIs y protecciones colectivas.</li>
                            <li>Designar a los trabajadores para tareas de prevención.</li>
                            <li>Recibir comunicaciones de seguridad y salud de diversas partes (CAE, contratistas, etc.).</li>
                            <li>Transmitir y hacer cumplir las órdenes del Coordinador de Actividades Preventivas (CAE).</li>
                            <li>Detectar variaciones en el proceso de montaje/desmontaje respecto a lo previsto y comunicarlas para su modificación.</li>
                            <li>Cumplimentar procedimientos de gestión de seguridad (control de acceso, actas de reunión, etc.).</li>
                        </ul>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">¿Cuándo recurrir al Recurso Preventivo?</h3>
                        <ul class="list-disc list-inside space-y-1 text-stone-700">
                            <li>Si las condiciones de trabajo no son seguras o no cumplen con las garantías mínimas de seguridad.</li>
                            <li>Para comunicar y proponer nuevos procedimientos de trabajo seguro.</li>
                            <li>Para coordinar trabajos simultáneos en tu área.</li>
                            <li>Si detectas cualquier condición insegura, riesgo no contemplado o situación que pueda poner en peligro tu seguridad o la de tus compañeros.</li>
                            <li>En trabajos con riesgos eléctricos, maquinaria pesada, alturas, o cuando varios equipos trabajan cerca.</li>
                            <li>Para asistir a reuniones de coordinación de seguridad.</li>
                            <li>Si necesitas información adicional sobre un protocolo o medida preventiva específica.</li>
                        </ul>
                        <p class="mt-2 text-sm text-stone-600">El Recurso Preventivo tiene la capacidad de **paralizar el trabajo** si las condiciones no son seguras, informando inmediatamente al CAE.</p>
                    </div>
                </div>
            </section>

            <section id="acciones-climaticas" class="content-section">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Acciones Climáticas</h2>
                    <p class="text-stone-600">Protocolos y medidas a seguir ante fenómenos meteorológicos adversos.</p>
                </div>

                <div id="climatic-actions-list" class="space-y-3">
                </div>
            </section>

            <section id="contactos" class="content-section">
                <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                    <h2 class="text-2xl font-bold text-amber-600 mb-2">Contactos Clave</h2>
                    <p class="text-stone-600">En caso de accidente o emergencia, avisa inmediatamente al personal responsable.</p>
                </div>

                <div class="space-y-4">
                     <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-red-600">EMERGENCIA GENERAL (Externas)</h3>
                        <p class="text-5xl font-extrabold text-red-700">112</p>
                        <a href="tel:112" class="mt-2 inline-block w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-center hover:bg-red-700 transition-colors">LLAMAR A EMERGENCIAS</a>
                    </div>
                    <div id="contacts-list" class="space-y-3">
                    </div>
                </div>
            </section>

        </main>
        
        <div id="emergency-button" class="fixed bottom-20 right-4 z-20">
             <button onclick="showEmergencyProtocol()" class="bg-red-600 text-white rounded-full p-4 shadow-lg flex items-center justify-center w-16 h-16 hover:bg-red-700 transition-transform hover:scale-110">
                <span class="text-3xl">🚨</span>
            </button>
        </div>

        <nav class="fixed bottom-0 left-0 right-0 bg-black text-white flex justify-around p-2 border-t-2 border-stone-700 z-10">
            <button data-target="inicio" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent active-nav">
                <span class="text-2xl">🏠</span>
                <span class="block text-xs">Inicio</span>
            </button>
            <button data-target="riesgos" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent">
                <span class="text-2xl">⚠️</span>
                <span class="block text-xs">Riesgos</span>
            </button>
            <button data-target="protocolos" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent">
                <span class="text-2xl">📜</span>
                <span class="block text-xs">Protocolos</span>
            </button>
            <button data-target="acciones-climaticas" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent">
                <span class="text-2xl">☁️</span>
                <span class="block text-xs">Clima</span>
            </button>
            <button data-target="recurso-preventivo" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent">
                <span class="text-2xl">🤝</span>
                <span class="block text-xs">RP</span>
            </button>
            <button data-target="contactos" class="nav-btn flex-1 text-center p-2 border-t-4 border-transparent">
                <span class="text-2xl">📞</span>
                <span class="block text-xs">Contactos</span>
            </button>
        </nav>
    </div>

    <div id="emergency-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden p-4 flex items-center justify-center">
        <div class="bg-white w-full max-w-md rounded-lg shadow-2xl p-6 relative text-center">
            <button onclick="closeEmergencyProtocol()" class="absolute top-2 right-2 text-stone-500 hover:text-stone-800 text-3xl">&times;</button>
            <h2 class="text-3xl font-extrabold text-red-700 mb-4">PROTOCOLO PAS</h2>
            <p class="mb-6 text-stone-700 font-medium">Ante un accidente, aplica SIEMPRE estas consignas:</p>
            <div class="space-y-4">
                <div class="bg-amber-100 border-l-4 border-amber-500 p-4 rounded-r-lg">
                    <h3 class="font-bold text-xl text-amber-800">1. PROTEGER</h3>
                    <p class="text-amber-700">Asegura la zona y al accidentado para que su situación no empeore.</p>
                </div>
                <div class="bg-sky-100 border-l-4 border-sky-500 p-4 rounded-r-lg">
                    <h3 class="font-bold text-xl text-sky-800">2. AVISAR</h3>
                    <p class="text-sky-700">Informa inmediatamente a tu responsable y a los contactos de emergencia.</p>
                </div>
                <div class="bg-emerald-100 border-l-4 border-emerald-500 p-4 rounded-r-lg">
                    <h3 class="font-bold text-xl text-emerald-800">3. SOCORRER</h3>
                    <p class="text-emerald-700">Presta los primeros auxilios solo si conoces las técnicas. No muevas al herido si no es imprescindible.</p>
                </div>
            </div>
             <a href="#contactos" onclick="navigateTo('contactos'); closeEmergencyProtocol();" class="mt-6 inline-block w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg text-center hover:bg-red-700 transition-colors">VER CONTACTOS Y LLAMAR</a>
        </div>
    </div>

    <!-- Chatbot Modal -->
    <div id="chatbot-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden p-4 flex items-center justify-center">
        <div class="bg-white w-full max-w-md rounded-lg shadow-2xl flex flex-col h-[90vh] relative">
            <div class="p-4 bg-blue-600 text-white rounded-t-lg flex justify-between items-center">
                <h2 class="text-xl font-bold">Asistente de Seguridad IA ✨</h2>
                <button onclick="closeChatbotModal()" class="text-white hover:text-blue-100 text-3xl">&times;</button>
            </div>
            <div id="chat-history" class="chat-history flex-grow p-4 overflow-y-auto">
                <div class="chat-message ai">¡Hola! Soy tu asistente de seguridad para el Monegros Desert Festival 2025. Pregúntame sobre riesgos, protocolos o cualquier duda de seguridad laboral.</div>
            </div>
            <div class="p-4 border-t border-stone-200 flex items-center">
                <input type="text" id="chat-input" placeholder="Escribe tu pregunta aquí..." class="flex-grow p-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="send-chat-btn" class="ml-3 bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center">
                    <span id="send-icon">Enviar</span>
                    <div id="loading-spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                </button>
            </div>
        </div>
    </div>

<script>
const riskData = {
    general: [
        { 
            title: 'Caídas a distinto y mismo nivel', 
            icon: '🚶',
            description: 'Tropiezos con objetos, cables, o caídas desde pequeñas alturas. Mantén las zonas de paso despejadas y respeta la señalización. Causadas por obstáculos en el suelo, superficies irregulares o mojadas, o desorden de materiales.',
            ppe: ['Calzado de seguridad antideslizante'],
            workInstructions: [
                'Respetar señalización y balizamiento de las zonas de paso y trabajo.',
                'Extremar precauciones en zonas de riesgo (plataformas, desniveles, cruces con trabajos activos).',
                'Mantener el orden y la limpieza en todas las áreas.',
                'No circular por zonas no habilitadas.',
                'No dejar suelos mojados o con residuos sin señalizar.'
            ]
        },
        { 
            title: 'Atropellos y golpes con vehículos',
            icon: '🚗',
            description: 'Riesgo de colisión con vehículos y maquinaria en movimiento. Presta máxima atención en zonas de maniobra y respeta la señalización vial. Causado por conducción temeraria o falta de zonas acotadas.',
            ppe: ['Chaleco de alta visibilidad'],
            workInstructions: [
                'Circular solo por zonas peatonales designadas.',
                'Extremar precauciones en zonas de cruce con vehículos y maquinaria.',
                'Atender y respetar la señalización y balizamiento de las zonas.',
                'No circular por vías habilitadas para vehículos.'
            ]
        },
        { 
            title: 'Exposición a temperaturas extremas (Calor)',
            icon: '☀️',
            description: 'Riesgo de golpe de calor, deshidratación o agotamiento por exposición prolongada al sol y altas temperaturas. Es crucial la hidratación constante y las pausas.',
            ppe: ['Gorra o sombrero', 'Ropa ligera y transpirable', 'Protección solar'],
            workInstructions: [
                'Hidratarse constantemente con agua fresca.',
                'Realizar pausas frecuentes en zonas con sombra o climatizadas.',
                'Vigilar síntomas de mareo, fatiga o dolor de cabeza.',
                'No trabajar sin protección adecuada en exposición prolongada.'
            ]
        },
        {
            title: 'Incendios',
            icon: '🔥',
            description: 'Riesgo de fuego por equipos eléctricos, láseres, o elementos de preparación de alimentos. Conocer el plan de emergencia y la ubicación de extintores es vital.',
            ppe: ['N/A'],
            workInstructions: [
                'Seguir indicaciones del personal de seguridad y plan de emergencia.',
                'No obstaculizar medios de extinción ni vías de evacuación.',
                'Prohibido fumar fuera de zonas habilitadas.',
                'No fumar en espacios cerrados o no habilitados.'
            ]
        }
    ],
    carga: [
        {
            title: 'Sobreesfuerzos y lesiones musculoesqueléticas',
            icon: '💪',
            description: 'Riesgo al levantar o mover cargas pesadas manualmente. Utiliza siempre medios mecánicos si es posible y adopta posturas correctas (espalda recta, flexionar rodillas).',
            ppe: ['Guantes de protección mecánica', 'Calzado de seguridad con puntera reforzada', 'Faja lumbar (opcional, según evaluación)'],
            workInstructions: [
                'Priorizar medios mecánicos para cargas.',
                'Si es manual, manipular correctamente: espalda recta, flexionar rodillas, evitar giros de tronco.',
                'Distribuir el peso y no exceder 25kg por persona (salvo excepciones).',
                'No levantar cargas excesivas sin ayuda o medios mecánicos.'
            ]
        },
        {
            title: 'Caída de objetos durante la manipulación',
            icon: '📦',
            description: 'Riesgo de caída de materiales durante la carga, descarga o apilamiento. Asegura siempre las cargas y apila de forma estable.',
            ppe: ['Casco', 'Calzado de seguridad', 'Guantes de agarre'],
            workInstructions: [
                'Asegurar la carga en equipos de transporte.',
                'Apilar materiales de forma estable y segura.',
                'Mantener zonas de almacenamiento ordenadas.',
                'No apilar materiales de forma inestable.'
            ]
        },
        {
            title: 'Atropellos en zonas de carga/descarga',
            icon: '🚚',
            description: 'Zonas con alto movimiento de vehículos y personas. El personal a pie debe ser siempre visible y mantenerse en áreas seguras.',
            ppe: ['Chaleco de alta visibilidad'],
            workInstructions: [
                'Mantenerse en zonas peatonales seguras.',
                'Prestar atención a la circulación de vehículos y maquinaria.',
                'Respetar señalización y balizamiento de zonas de vehículos.',
                'No circular por vías designadas para vehículos.'
            ]
        },
        {
            title: 'Contactos eléctricos',
            icon: '⚡️',
            description: 'Riesgo de electrocución por cableado no protegido o instalaciones en mal estado. No manipular cuadros eléctricos y mantenerlos cerrados.',
            ppe: ['N/A'],
            workInstructions: [
                'No manipular cuadros eléctricos.',
                'Mantener cuadros eléctricos cerrados y señalizados.',
                'Reportar cualquier anomalía en instalaciones eléctricas.',
                'No acceder a zonas eléctricas no autorizadas.'
            ]
        }
    ],
    altura: [
        {
            title: 'Caída de personas a distinto nivel',
            icon: '�',
            description: 'Riesgo de caídas desde andamios, escenarios o estructuras elevadas. El uso de sistemas anticaída es obligatorio y su revisión constante.',
            ppe: ['Arnés de seguridad con doble cabo de anclaje', 'Casco con barboquejo', 'Calzado de seguridad', 'Guantes de agarre'],
            workInstructions: [
                'Uso obligatorio de sistemas de protección individual y colectiva.',
                'Revisión previa de arnés y doble gancho antes de cada uso.',
                'Verificar el uso correcto de todos los EPIs de altura.',
                'No realizar trabajos en altura sin EPIs adecuados y revisados.'
            ]
        },
        {
            title: 'Caída de objetos desde altura',
            icon: '🔩',
            description: 'Riesgo de caída de herramientas o materiales sobre personas. Delimitar y señalizar la zona inferior de trabajo y asegurar las herramientas.',
            ppe: ['Casco con barboquejo'],
            workInstructions: [
                'Delimitar y señalizar la zona de trabajo inferior.',
                'Asegurar herramientas con cordinos retráctiles.',
                'No trabajar directamente debajo de otros trabajos en altura.',
                'No dejar herramientas o materiales sueltos en altura.'
            ]
        },
        {
            title: 'Viento fuerte en altura',
            icon: '💨',
            description: 'El viento puede desestabilizar al trabajador y a las estructuras. Suspender los trabajos si las rachas de viento son peligrosas.',
            ppe: ['Arnés de seguridad', 'Casco con barboquejo'],
            workInstructions: [
                'Suspender trabajos en altura si el viento supera los límites de seguridad (indicados por el CAE/RP).',
                'Asegurar elementos sueltos en estructuras elevadas.',
                'No trabajar en altura con vientos superiores a 35-40 km/h.'
            ]
        },
        {
            title: 'Trabajos simultáneos en la misma vertical',
            icon: '⬇️',
            description: 'Riesgo de caída de objetos o interacción peligrosa entre equipos. Evitar siempre que sea posible o coordinar estrictamente.',
            ppe: ['Casco con barboquejo'],
            workInstructions: [
                'Evitar trabajos simultáneos en la misma vertical.',
                'Si son imprescindibles, establecer coordinación estricta y señalización reforzada.',
                'No realizar trabajos simultáneos en la misma vertical sin coordinación y medidas de seguridad adicionales.'
            ]
        }
    ],
    soldador: [
        {
            title: 'Riesgo de Incendio y Explosión',
            icon: '🔥',
            description: 'La soldadura genera chispas y calor intenso, con riesgo de ignición de materiales combustibles y explosión de gases.',
            ppe: ['Mandil de cuero', 'Guantes de cuero de manga larga', 'Calzado de seguridad tipo bota aislante'],
            workInstructions: [
                'Mantener el área de trabajo libre de materiales combustibles.',
                'Proteger materiales inmovilizados con ignífugos.',
                'Asegurar ventilación adecuada para dispersar gases.',
                'No soldar cerca de materiales inflamables o explosivos.'
            ]
        },
        {
            title: 'Quemaduras y Contacto Térmico',
            icon: '♨️',
            description: 'Contacto con superficies calientes, chispas o metal fundido. Requiere protección total del cuerpo.',
            ppe: ['Pantalla facial para soldadura', 'Guantes de cuero de manga larga', 'Mandil de cuero', 'Ropa ignífuga'],
            workInstructions: [
                'Usar ropa de protección adecuada que cubra todo el cuerpo.',
                'Evitar el contacto directo con la pieza soldada hasta que se enfríe.',
                'No usar ropa sintética que pueda fundirse.',
                'No tocar la pieza soldada o el electrodo sin protección.'
            ]
        },
        {
            title: 'Exposición a Humos y Gases',
            icon: '😷',
            description: 'Inhalación de humos y gases tóxicos liberados durante la soldadura, que pueden causar problemas respiratorios.',
            ppe: ['Mascarilla de protección respiratoria (si se trabaja con partículas irritantes)'],
            workInstructions: [
                'Asegurar ventilación adecuada en el área de trabajo.',
                'Usar mascarilla respiratoria si la ventilación es insuficiente o los humos son densos.',
                'Buscar la mejor posición para soldar, evitando inhalar directamente los gases.',
                'No soldar en espacios confinados sin ventilación forzada.'
            ]
        },
        {
            title: 'Contacto Eléctrico',
            icon: '⚡️',
            description: 'Riesgo de electrocución por equipos en mal estado o conexiones incorrectas.',
            ppe: ['Guantes dieléctricos (si aplica)', 'Calzado de seguridad tipo bota aislante'],
            workInstructions: [
                'Conectar el equipo solo a tomas con toma de tierra.',
                'Revisar el aislamiento de los cables antes de cada uso.',
                'No usar adornos metálicos durante la soldadura.',
                'No manipular el equipo con las manos mojadas.'
            ]
        }
    ],
    maquinaria: [
        { 
            title: 'Atropellos, golpes y atrapamientos',
            icon: '🚜',
            description: 'Riesgos durante la operación de carretillas, plataformas elevadoras o grúas. Respetar distancias de seguridad. No pasar bajo cargas suspendidas.',
            ppe: ['Chaleco de alta visibilidad', 'Calzado de seguridad', 'Casco'],
            workInstructions: [
                'Respetar distancias de seguridad con maquinaria en movimiento.',
                'No pasar bajo cargas suspendidas.',
                'Operar a velocidad segura y con precaución.',
                'No transportar personas en la maquinaria.',
                'No operar maquinaria sin formación y autorización.'
            ]
        },
        {
            title: 'Vuelco de maquinaria',
            icon: '🔄',
            description: 'Operar solo en terrenos estables y nivelados. No sobrepasar la capacidad de carga máxima del equipo. Uso obligatorio de cinturón de seguridad.',
            ppe: ['N/A (Cinturón del equipo)'],
            workInstructions: [
                'Operar solo en terrenos estables y nivelados.',
                'No sobrepasar la capacidad de carga máxima del equipo.',
                'Uso obligatorio de cinturón de seguridad.',
                'No sobrecargar la maquinaria.',
                'No operar en terrenos inestables o con pendientes excesivas.'
            ]
        },
        {
            title: 'Contacto con líneas eléctricas aéreas',
            icon: '⚡️',
            description: 'Mantener distancia de seguridad con cualquier tendido eléctrico. Consultar el plano de instalaciones antes de usar grúas o plataformas.',
            ppe: ['Casco', 'Calzado de seguridad dieléctrico (si aplica)'],
            workInstructions: [
                'Mantener distancia de seguridad con líneas eléctricas.',
                'Consultar planos de instalaciones antes de operar maquinaria cerca de tendidos.',
                'Verificar aislamiento o desconexión de líneas si es necesario.',
                'No operar maquinaria cerca de líneas eléctricas sin medidas de seguridad.'
            ]
        }
    ],
    plataformas: [
        {
            title: 'Caída de personas desde la plataforma',
            icon: '⬇️',
            description: 'Riesgo por movimientos bruscos, sobrecarga, o uso inadecuado de protecciones. Mantener siempre ambos pies en la plataforma y usar arnés.',
            ppe: ['Arnés de seguridad con doble cabo de anclaje', 'Casco con barboquejo', 'Calzado de seguridad'],
            workInstructions: [
                'Mantener siempre ambos pies sobre la plataforma.',
                'Uso obligatorio de cinturones de seguridad o arneses anclados.',
                'No usar elementos auxiliares para ganar altura sobre la plataforma.',
                'No subir ni bajar de la plataforma si está elevada.'
            ]
        },
        {
            title: 'Vuelco de la plataforma',
            icon: '🔄',
            description: 'Riesgo por terreno inestable, sobrecarga, viento fuerte o anulación de sistemas de seguridad. Verificar nivelación y condiciones ambientales.',
            ppe: ['N/A (Cinturón del equipo)'],
            workInstructions: [
                'Inspeccionar y nivelar la superficie de apoyo antes de cada uso.',
                'No exceder la capacidad máxima de peso de la plataforma.',
                'No elevar o conducir con viento o condiciones meteorológicas adversas.',
                'No operar en terrenos inestables o con pendientes excesivas.'
            ]
        },
        {
            title: 'Contacto con líneas eléctricas aéreas',
            icon: '⚡️',
            description: 'Riesgo de electrocución al acercar la plataforma a tendidos eléctricos. Mantener distancias de seguridad y verificar aislamiento.',
            ppe: ['Casco', 'Calzado de seguridad dieléctrico (si aplica)'],
            workInstructions: [
                'Verificar la presencia de líneas eléctricas en la trayectoria vertical.',
                'Mantener una distancia de seguridad mínima con tendidos eléctricos.',
                'Asegurar el aislamiento o desconexión de líneas si es necesario.',
                'No operar cerca de líneas eléctricas sin medidas de seguridad.'
            ]
        },
        {
            title: 'Fallo de sistemas de seguridad',
            icon: '⚙️',
            description: 'Riesgo por mal funcionamiento o alteración de los dispositivos de seguridad de la PEMP. Realizar inspecciones previas y no modificar el equipo.',
            ppe: ['N/A'],
            workInstructions: [
                'Realizar inspección visual detallada antes de cada uso (soldaduras, fugas, cables, frenos).',
                'Asegurar que los controles de operación funcionen correctamente.',
                'Reportar cualquier defecto que afecte la seguridad y corregirlo antes de usar.',
                'Prohibido alterar, modificar o desconectar los sistemas de seguridad.'
            ]
        }
    ],
    riggers: [
        {
            title: 'Caída de personas a distinto nivel (Rigging)',
            icon: '🪢',
            description: 'Riesgo extremo al trabajar en estructuras elevadas, parrillas de rigging o en suspensión. Uso de doble sistema de seguridad y revisión constante.',
            ppe: ['Arnés integral', 'Sistema de doble sujeción', 'Doble gancho YMGO con absorbedor', 'Posicionador', 'Descensor ID', 'ASAP', 'Casco de seguridad para alturas', 'Guantes de trabajo', 'Botas de seguridad'],
            workInstructions: [
                'Uso obligatorio de todos los EPIs de Rigger.',
                'Revisión previa del funcionamiento de los EPIs de altura.',
                'Descenso con doble cuerda independiente y línea de vida ASAP.',
                'No trabajar sin doble sujeción.'
            ]
        },
        {
            title: 'Caída de objetos desde altura (Rigging)',
            icon: '🪝',
            description: 'Riesgo de caída de herramientas, motores o elementos suspendidos. Delimitar estrictamente la zona inferior y asegurar todo material.',
            ppe: ['Casco con barboquejo'],
            workInstructions: [
                'Delimitar y acotar estrictamente la zona inferior de trabajo.',
                'Asegurar herramientas con cuerdas retráctiles/cordinos.',
                'Verificar anclajes y sistemas de seguridad de elementos suspendidos.',
                'No permitir personal bajo estructuras en movimiento.'
            ]
        },
        {
            title: 'Viento fuerte y estabilidad de estructuras',
            icon: '🌬️',
            description: 'El viento puede afectar gravemente la estabilidad de las estructuras y la seguridad de los riggers. Suspender trabajos si hay riesgo.',
            ppe: ['N/A'],
            workInstructions: [
                'Suspender trabajos si las rachas de viento superan los límites de seguridad.',
                'Asegurar estructuras y elementos suspendidos ante vientos fuertes.',
                'No realizar trabajos de rigging con vientos fuertes.'
            ]
        },
        {
            title: 'Fallo en la elevación/descenso de cargas',
            icon: '⛓️',
            description: 'Riesgo por mal funcionamiento de motores, cables o falta de coordinación. Requiere verificación de equipos y comunicación constante.',
            ppe: ['N/A'],
            workInstructions: [
                'Verificar funcionamiento y certificación CE de motores y bolsas de cadenas.',
                'Coordinación estricta entre riggers y jefe de equipo.',
                'Asegurar que los sistemas de parada de emergencia funcionan.',
                'No manipular el equipo de seguridad de la grúa.'
            ]
        }
    ],
    electricidad: [
        {
            title: 'Contacto eléctrico directo o indirecto',
            icon: '⚡️',
            description: 'Riesgo de electrocución al manipular cableado, cuadros o equipos. Trabajar siempre sin tensión y usar herramientas aislantes.',
            ppe: ['Guantes dieléctricos', 'Calzado de seguridad aislante', 'Gafas de seguridad', 'Casco aislante'],
            workInstructions: [
                'Trabajar siempre sin tensión eléctrica.',
                'Verificar la ausencia de tensión antes de manipular y re-comprobar.',
                'Utilizar equipos y herramientas aislantes homologadas.',
                'No manipular instalaciones eléctricas bajo tensión sin autorización y EPIs específicos.'
            ]
        },
        {
            title: 'Incendio de origen eléctrico',
            icon: '🔥',
            description: 'Riesgo por sobrecarga de líneas o cortocircuitos. No sobrecargar enchufes ni generadores y usar cableado adecuado.',
            ppe: ['N/A'],
            workInstructions: [
                'No sobrecargar enchufes ni generadores.',
                'Usar cableado de sección adecuada y en buen estado.',
                'Mantener cuadros eléctricos cerrados y con protecciones.',
                'No usar equipos o cableado en mal estado.'
            ]
        }
    ],
    tecnico_audiovisual: [
        {
            title: 'Caídas a distinto y mismo nivel',
            icon: '🚶',
            description: 'Tropiezos con cables, equipos o caídas desde estructuras elevadas (andamios, escenarios).',
            ppe: ['Calzado de seguridad antideslizante', 'Casco de seguridad con barboquejo (si trabaja en altura)', 'Guantes de trabajo'],
            workInstructions: [
                'Mantener el área de trabajo limpia y libre de cables sueltos.',
                'Asegurar los cables con bridas o cintas en zonas de paso.',
                'Extremar precauciones al trabajar en alturas y usar los EPIs adecuados.',
                'Verificar la estabilidad de andamios y plataformas antes de usarlos.',
                'No trabajar en zonas oscuras sin iluminación adecuada.'
            ]
        },
        {
            title: 'Caída de objetos desde altura',
            icon: '🔩',
            description: 'Riesgo de caída de focos, altavoces, pantallas o herramientas sobre personas.',
            ppe: ['Casco de seguridad con barboquejo'],
            workInstructions: [
                'Asegurar todos los elementos suspendidos (focos, altavoces, pantallas) con sistemas de seguridad secundarios.',
                'Utilizar cordinos o correas para asegurar herramientas al trabajar en altura.',
                'Delimitar y señalizar las zonas debajo de trabajos en altura.',
                'No dejar herramientas o materiales sueltos en plataformas elevadas.'
            ]
        },
        {
            title: 'Contactos eléctricos',
            icon: '⚡️',
            description: 'Riesgo de electrocución al manipular cableado, cuadros eléctricos o equipos de sonido/iluminación.',
            ppe: ['Guantes dieléctricos (si aplica)', 'Calzado de seguridad aislante', 'Gafas de seguridad'],
            workInstructions: [
                'Trabajar siempre sin tensión eléctrica, verificando la ausencia de tensión antes de manipular.',
                'Utilizar herramientas aislantes homologadas.',
                'No manipular cuadros eléctricos sin autorización y formación específica.',
                'Revisar el estado de cables y conexiones antes de cada uso.',
                'Reportar cualquier anomalía en instalaciones eléctricas.'
            ]
        },
        {
            title: 'Sobreesfuerzos',
            icon: '💪',
            description: 'Riesgo al levantar y mover equipos pesados (altavoces, amplificadores, estructuras de truss).',
            ppe: ['Guantes de protección mecánica'],
            workInstructions: [
                'Utilizar medios mecánicos (carros, elevadores) para el transporte de equipos pesados.',
                'Aplicar técnicas de levantamiento seguro: espalda recta, flexionar rodillas, pedir ayuda para cargas voluminosas.',
                'Organizar el área de trabajo para minimizar la manipulación manual de cargas.'
            ]
        }
    ],
    tecnico_camara: [
        {
            title: 'Caídas al mismo nivel',
            icon: '🚶',
            description: 'Tropiezos con cables, trípodes, o irregularidades del terreno.',
            ppe: ['Calzado cómodo con suela antideslizante'],
            workInstructions: [
                'Mantener el área de trabajo despejada de cables y obstáculos.',
                'Asegurar los cables de cámara y alimentación para evitar tropiezos.',
                'Prestar atención al desplazarse, especialmente en zonas con poca luz o desniveles.'
            ]
        },
        {
            title: 'Golpes y cortes',
            icon: '🔪',
            description: 'Riesgo al manipular equipos de cámara, lentes o accesorios con bordes afilados o pesados.',
            ppe: ['Guantes de trabajo (para manipulación de equipos)'],
            workInstructions: [
                'Manipular equipos de cámara y accesorios con cuidado.',
                'Asegurar los trípodes y soportes para evitar caídas de equipos.',
                'Transportar equipos en estuches o bolsas adecuadas para evitar golpes.'
            ]
        },
        {
            title: 'Sobreesfuerzos',
            icon: '🏋️',
            description: 'Riesgo por la manipulación de cámaras pesadas, trípodes o el mantenimiento de posturas forzadas durante la filmación.',
            ppe: ['N/A'],
            workInstructions: [
                'Utilizar equipos de apoyo (monopies, chalecos de soporte) para cámaras pesadas.',
                'Realizar pausas frecuentes y estiramientos para evitar fatiga postural.',
                'Ajustar la altura de los trípodes para mantener una postura ergonómica.',
                'Pedir ayuda para el transporte de equipos voluminosos.'
            ]
        },
        {
            title: 'Exposición a ruido',
            icon: '👂',
            description: 'Niveles de ruido elevados en zonas de conciertos o escenarios.',
            ppe: ['Protección auditiva (opcional, según nivel de ruido)'],
            workInstructions: [
                'Utilizar protectores auditivos si se trabaja en zonas con niveles de ruido elevados de forma prolongada.'
            ]
        }
    ],
    backliner: [
        {
            title: 'Sobreesfuerzos y lesiones musculoesqueléticas',
            icon: '💪',
            description: 'Riesgo al levantar y mover instrumentos, amplificadores, cajas de transporte (flightcases) y otros equipos de banda.',
            ppe: ['Guantes de protección mecánica', 'Calzado de seguridad con puntera reforzada'],
            workInstructions: [
                'Utilizar carros o dolly para el transporte de equipos pesados siempre que sea posible.',
                'Aplicar técnicas de levantamiento seguro: espalda recta, flexionar rodillas, pedir ayuda para cargas voluminosas.',
                'Organizar el área de backstage y escenario para minimizar la manipulación manual excesiva.'
            ]
        },
        {
            title: 'Golpes y cortes',
            icon: '🔪',
            description: 'Riesgo por la manipulación de flightcases, instrumentos o elementos metálicos del escenario.',
            ppe: ['Guantes de trabajo'],
            workInstructions: [
                'Manipular los equipos con cuidado, prestando atención a bordes afilados o salientes.',
                'Asegurar los flightcases y equipos para evitar caídas o movimientos inesperados.',
                'Mantener las zonas de paso despejadas durante los cambios de equipo.'
            ]
        },
        {
            title: 'Caídas al mismo nivel',
            icon: '🚶',
            description: 'Tropiezos con cables, pedales, alfombras o irregularidades en el escenario/backstage.',
            ppe: ['Calzado de seguridad antideslizante'],
            workInstructions: [
                'Asegurar el cableado en el escenario y backstage para evitar tropiezos.',
                'Mantener el orden y la limpieza en todas las áreas de trabajo.',
                'Prestar atención al desplazarse, especialmente en zonas con poca luz.'
            ]
        },
        {
            title: 'Exposición a ruido',
            icon: '👂',
            description: 'Niveles de ruido elevados durante pruebas de sonido o actuaciones en vivo.',
            ppe: ['Protección auditiva'],
            workInstructions: [
                'Utilizar protectores auditivos (tapones o cascos) durante las pruebas de sonido y las actuaciones en vivo para proteger la audición.'
            ]
        }
    ],
    personal_limpieza: [
        {
            title: 'Caídas al mismo nivel por resbalones',
            icon: '⚠️',
            description: 'Riesgo por suelos mojados, derrames o residuos. Es fundamental señalizar y limpiar inmediatamente.',
            ppe: ['Calzado de seguridad cómodo con suela antideslizante'],
            workInstructions: [
                'Limpiar líquidos derramados u objetos rotos inmediatamente.',
                'Señalizar los suelos resbaladizos con conos o carteles hasta que sequen.',
                'Mantener las zonas de paso despejadas.',
                'No dejar suelos mojados o con residuos sin señalizar.'
            ]
        },
        {
            title: 'Exposición a productos químicos',
            icon: '🧪',
            description: 'Riesgo por contacto o inhalación de productos de limpieza. Usar protección adecuada y seguir las instrucciones.',
            ppe: ['Guantes de trabajo con protección química (si aplica)', 'Mascarilla de seguridad (si aplica)'],
            workInstructions: [
                'Los productos químicos deben estar señalizados y mantenerse cerrados.',
                'No mezclar productos químicos sin conocer su compatibilidad.',
                'Usar guantes y mascarilla según las fichas de seguridad.',
                'No usar productos químicos sin leer sus instrucciones y precauciones.'
            ]
        },
        {
            title: 'Sobreesfuerzos',
            icon: '💪',
            description: 'Al levantar cubos, mover carros o manipular residuos. Aplicar técnicas de levantamiento seguro.',
            ppe: ['N/A'],
            workInstructions: [
                'Utilizar carros y equipos de limpieza con ruedas para el transporte.',
                'Levantar objetos pesados flexionando las rodillas y manteniendo la espalda recta.',
                'Pedir ayuda para cargas voluminosas o muy pesadas.',
                'No cargar cubos o bolsas de basura excesivamente pesadas.'
            ]
        },
        {
            title: 'Riesgo Biológico (COVID-19 y otros)',
            icon: '🦠',
            description: 'Exposición a agentes biológicos en zonas de residuos o baños. Mantener higiene y usar protección.',
            ppe: ['Mascarilla de seguridad', 'Guantes desechables'],
            workInstructions: [
                'Usar guantes desechables al manipular residuos.',
                'Realizar higiene de manos frecuente.',
                'Usar mascarilla si hay riesgo de exposición a aerosoles.',
                'No tocar residuos sin guantes.'
            ]
        }
    ],
    personal_bares: [
        {
            title: 'Caídas al mismo nivel',
            icon: '🚶',
            description: 'Riesgo por suelos mojados, derrames de bebidas o residuos de comida. Mantener la zona limpia y seca.',
            ppe: ['Calzado cómodo con suela antideslizante'],
            workInstructions: [
                'Limpiar líquidos derramados u objetos rotos inmediatamente.',
                'Extremar la precaución al desplazarse, evitando prisas.',
                'Mantener las zonas de paso despejadas.',
                'No dejar derrames sin limpiar.'
            ]
        },
        {
            title: 'Golpes y cortes',
            icon: '🔪',
            description: 'Riesgo al manipular vasos, botellas, hielo o utensilios de bar. Usar protección y manipular con cuidado.',
            ppe: ['Guantes de trabajo (si aplica)'],
            workInstructions: [
                'Manipular cristalería con cuidado, especialmente al lavarla.',
                'Usar utensilios adecuados para cada tarea (ej. recogedor de hielo).',
                'Almacenar botellas y vasos de forma segura.',
                'No intentar recoger cristales rotos con las manos desprotegidas.'
            ]
        },
        {
            title: 'Sobreesfuerzos y posturas forzadas',
            icon: '🏋️',
            description: 'Al levantar cajas de bebidas, barriles o mantener posturas estáticas prolongadas. Organizar el trabajo y usar técnicas correctas.',
            ppe: ['N/A'],
            workInstructions: [
                'Colocar botellas y vasos de uso frecuente al alcance (entre hombros y cadera).',
                'Utilizar carros de transporte para cargas pesadas.',
                'Realizar estiramientos y pausas activas.',
                'No levantar objetos excesivamente pesados sin ayuda.'
            ]
        },
        {
            title: 'Exposición a ruido',
            icon: '👂',
            description: 'Niveles de ruido elevados en la zona de bares durante el festival. Proteger la audición si es necesario.',
            ppe: ['Protección auditiva (opcional, según nivel de ruido)'],
            workInstructions: [
                'Mantenerse alejado de fuentes de ruido excesivo si es posible.',
                'Usar protección auditiva si el nivel de ruido es constante y elevado.'
            ]
        }
    ],
    personal_restauracion: [
        {
            title: 'Caídas al mismo nivel',
            icon: '🚶',
            description: 'Riesgo por suelos mojados, grasientos o con restos de comida. Mantener la cocina y las zonas de servicio limpias y secas.',
            ppe: ['Calzado cómodo con suela antideslizante'],
            workInstructions: [
                'Limpiar derrames y residuos inmediatamente.',
                'Usar calzado con suela antideslizante.',
                'Extremar la precaución al desplazarse, especialmente en zonas de cocina.',
                'No dejar suelos resbaladizos sin limpiar o señalizar.'
            ]
        },
        {
            title: 'Cortes y quemaduras',
            icon: '🔪🔥',
            description: 'Riesgo al manipular cuchillos, utensilios calientes, freidoras o fogones. Usar protección y seguir protocolos de seguridad en cocina.',
            ppe: ['Guantes de trabajo (si aplica)', 'Mandiles', 'Gorros', 'Manga larga'],
            workInstructions: [
                'Usar cuchillos afilados y con cuidado.',
                'Orientar mangos de sartenes hacia el interior.',
                'No calentar vajilla no destinada a comida en el horno.',
                'Usar guantes térmicos para manipular objetos calientes.',
                'No tocar superficies calientes sin protección.'
            ]
        },
        {
            title: 'Riesgo de Incendio y Explosión (Gas/Eléctrico)',
            icon: '🔥',
            description: 'En cocinas, por fugas de gas, sobrecargas eléctricas o acumulación de grasa. Revisar instalaciones y conocer ubicación de extintores.',
            ppe: ['N/A (Extintores y sistemas de seguridad de cocina)'],
            workInstructions: [
                'Revisar periódicamente las instalaciones de gas y eléctricas.',
                'Mantener campanas extractoras limpias de grasa.',
                'Conocer la ubicación y uso de extintores.',
                'No manipular instalaciones de gas o eléctricas sin autorización.'
            ]
        },
        {
            title: 'Sobreesfuerzos',
            icon: '🏋️',
            description: 'Al levantar ollas, bandejas o mover equipos. Aplicar ergonomía y pedir ayuda.',
            ppe: ['N/A'],
            workInstructions: [
                'Utilizar carros para el transporte de cargas pesadas.',
                'Levantar objetos pesados flexionando las rodillas.',
                'Distribuir el peso y organizar las tareas.',
                'No levantar objetos excesivamente pesados sin asistencia.'
            ]
        }
    ],
    movilidad_personal: [
        {
            title: 'Atropellos y golpes con vehículos',
            icon: '🚗',
            description: 'Riesgo de colisión con vehículos y maquinaria en movimiento. Presta máxima atención en zonas de circulación.',
            ppe: ['Chaleco de alta visibilidad', 'Casco (para bicicletas/patinetes)'],
            workInstructions: [
                'Circular solo por vías habilitadas y respetar la señalización de tráfico.',
                'Extremar precauciones en cruces, curvas y zonas con visibilidad reducida.',
                'Mantener una distancia de seguridad adecuada con otros vehículos y peatones.',
                'No utilizar el teléfono móvil mientras se circula, salvo con sistema de manos libres.',
                'No circular bajo la influencia de alcohol o drogas.',
                'No arrojar objetos desde el vehículo en movimiento.'
            ]
        },
        {
            title: 'Caídas al mismo nivel',
            icon: '🚶',
            description: 'Caídas por irregularidades en el terreno, obstáculos o pérdida de control del vehículo.',
            ppe: ['Calzado adecuado y cómodo'],
            workInstructions: [
                'Prestar atención a las condiciones del terreno y evitar zonas con obstáculos o superficies resbaladizas.',
                'Adaptar la velocidad a las condiciones del entorno y la visibilidad.',
                'Asegurar que el vehículo esté en buen estado (frenos, neumáticos) antes de usarlo.'
            ]
        },
        {
            title: 'Choques contra objetos inmóviles',
            icon: '🚧',
            description: 'Impactos con estructuras, vallas, material almacenado o elementos del recinto.',
            ppe: ['N/A'],
            workInstructions: [
                'Respetar las zonas delimitadas y señalizadas.',
                'Mantener la atención en el entorno para anticipar obstáculos.',
                'No circular por zonas no autorizadas o con acceso restringido.'
            ]
        },
        {
            title: 'Sobreesfuerzos (al transportar cargas)',
            icon: '💪',
            description: 'Riesgo al transportar cargas en bicicletas o vehículos personales sin la preparación adecuada.',
            ppe: ['N/A'],
            workInstructions: [
                'Si se transportan cargas, el vehículo debe estar equipado para ello (portaequipajes, remolques).',
                'Distribuir el peso de la carga de manera uniforme y no sobrecargar el vehículo.',
                'Asegurar la carga para evitar que se desplace o caiga durante el trayecto.'
            ]
        }
    ]
};

const protocolsData = [
    {
        title: 'Protocolo de Emergencia (PAS)',
        icon: '🚨',
        content: `
            <p class="mb-2">Ante cualquier accidente, la actuación se basa en la conducta <strong>PAS: Proteger, Avisar y Socorrer.</strong></p>
            <ol class="list-decimal list-inside space-y-2">
                <li><strong>Proteger:</strong> Lo primero es hacer seguro el lugar del accidente, tanto para el accidentado como para ti. Elimina el riesgo que ha causado el accidente (corta la corriente, para la máquina, etc.). Señaliza la zona.</li>
                <li><strong>Avisar:</strong> Llama inmediatamente a los responsables (Jefe de Producción, Coordinador de Prevención) y al 112 si es grave. Proporciona información clara: lugar exacto, tipo de accidente, número de heridos y su estado aparente.</li>
                <li><strong>Socorrer:</strong> Atiende al herido. No le muevas a menos que haya un peligro mayor. Si está inconsciente y respira, colócalo en posición lateral de seguridad. No le des de beber. Afloja la ropa que le oprima. Abrígalo para que no pierda calor corporal.</li>
            </ol>
            <p class="mt-4 font-bold text-red-600">En caso de caída de altura, ¡NO MUEVAS AL HERIDO NI LE QUITES EL CASCO!</p>
        `
    },
    {
        title: 'Reanimación Cardiopulmonar (RCP)',
        icon: '❤️',
        content: `
            <p class="mb-4 text-stone-700">La RCP es una técnica de emergencia que puede salvar vidas cuando la respiración o el corazón de una persona se han detenido. Es fundamental actuar rápidamente.</p>
            <p class="text-sm text-red-600 mb-4"><strong>Nota:</strong> Estas imágenes son solo ejemplos visuales. Para una formación completa y práctica, acude a cursos certificados de primeros auxilios.</p>

            <div class="space-y-6">
                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">1. Evaluar la Seguridad y Conciencia</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Comprobar+Conciencia" alt="Imagen de una persona comprobando la conciencia de otra persona en el suelo." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Asegura que el entorno es seguro. Luego, golpea suavemente al paciente en el hombro y pregúntale en voz alta: "¿Se encuentra bien?". Observa si responde o se mueve.</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">2. Pedir Ayuda y Abrir Vías Aéreas</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Llamar+a+Emergencias" alt="Imagen de una persona llamando al 112 con un teléfono." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Si no responde, pide a alguien que llame al 112 (o al número de emergencias local) y que busque un desfibrilador (DEA) si hay uno cerca. Inclina la cabeza hacia atrás y levanta la barbilla para abrir la vía aérea.</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">3. Comprobar Respiración</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Comprobar+Respiracion" alt="Imagen de una persona comprobando la respiración de otra persona." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Acerca tu oído a la boca y nariz del paciente, mira el pecho para ver si se eleva y siente el aire en tu mejilla. Hazlo durante no más de 10 segundos.</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">4. Iniciar Compresiones Torácicas</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Compresiones+Toracicas" alt="Imagen de una persona realizando compresiones torácicas a otra persona." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Si no respira o solo jadea, comienza las compresiones. Coloca el talón de una mano en el centro del pecho (mitad inferior del esternón) y la otra mano encima. Mantén los brazos rectos y comprime el pecho al menos 5 cm, a un ritmo de 100-120 compresiones por minuto. (Piensa en el ritmo de la canción "Stayin' Alive").</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">5. Realizar Respiraciones de Rescate (Boca a Boca)</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Respiraciones+Boca+a+Boca" alt="Imagen de una persona realizando respiración boca a boca." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Después de 30 compresiones, realiza 2 respiraciones de rescate. Inclina la cabeza, levanta la barbilla, pinza la nariz y sella tu boca sobre la del paciente. Sopla durante 1 segundo, observando que el pecho se eleve. Repite una segunda vez.</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">6. Continuar el Ciclo</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Continuar+RCP" alt="Imagen que representa la continuidad de la RCP." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Continúa con ciclos de 30 compresiones y 2 respiraciones hasta que llegue la ayuda profesional o el paciente muestre signos de recuperación (movimiento, respiración normal).</p>
                </div>

                <div class="flex flex-col items-center text-center">
                    <h4 class="font-bold text-lg text-blue-700 mb-2">7. Uso del Desfibrilador Externo Automático (DEA)</h4>
                    <img src="https://placehold.co/300x200/ADD8E6/000000?text=Uso+de+DEA" alt="Imagen de un desfibrilador externo automático (DEA) con parches." class="rounded-lg shadow-md mb-2">
                    <p class="text-stone-700 text-sm">Si hay un DEA disponible, enciéndelo y sigue sus instrucciones de voz. Coloca los parches en el pecho desnudo del paciente. El DEA analizará el ritmo cardíaco y te indicará si es necesario aplicar una descarga. Si lo hace, asegúrate de que nadie toque al paciente durante la descarga.</p>
                </div>
            </div>
            <p class="mt-4 text-sm text-red-600"><strong>Recuerda:</strong> La calidad de las compresiones es crucial. Empuja fuerte y rápido en el centro del pecho, permitiendo que el pecho se recupere completamente entre compresiones.</p>
        `
    },
    {
        title: 'Normas Generales de Seguridad',
        icon: '✅',
        content: `
            <ul class="list-disc list-inside space-y-2">
                <li>Es obligatorio el uso de los Equipos de Protección Individual (EPIs) definidos para cada tarea.</li>
                <li>Mantener el orden y la limpieza en el puesto de trabajo. Las zonas de paso deben estar siempre despejadas.</li>
                <li>Prohibido el consumo de alcohol o drogas.</li>
                <li>No está permitido fumar fuera de las zonas habilitadas.</li>
                <li>Comunica cualquier condición insegura que detectes a tu superior inmediato.</li>
                <li>No utilices maquinaria o herramientas para las que no has sido formado y autorizado.</li>
            </ul>
        `
    },
    {
        title: 'Medidas ante el Calor Extremo',
        icon: '☀️',
        content: `
            <ul class="list-disc list-inside space-y-2">
                <li><strong>Hidratación:</strong> Bebe agua fresca de forma regular, incluso si no tienes sed (aproximadamente 1 vaso cada 20 minutos).</li>
                <li><strong>Pausas:</strong> Realiza pausas frecuentes en lugares frescos y a la sombra.</li>
                <li><strong>Ropa y Protección:</strong> Utiliza ropa de trabajo ligera, de colores claros y transpirable. Cubre la cabeza con gorra o sombrero. Usa crema de protección solar.</li>
                <li><strong>Planificación:</strong> Evita los trabajos de mayor esfuerzo físico en las horas centrales del día (14:00-18:00).</li>
                <li><strong>Vigilancia:</strong> Presta atención a los síntomas de agotamiento por calor: mareo, fatiga, dolor de cabeza, náuseas. Si los sientes, para la actividad, avisa a un compañero y ve a un lugar fresco.</li>
            </ul>
        `
    },
    {
        title: 'Actuación frente a Viento Fuerte',
        icon: '💨',
        content: `
            <ul class="list-disc list-inside space-y-2">
                <li>Se suspenderán los trabajos en altura (andamios, plataformas, cubiertas) si las rachas de viento superan los 50 km/h o dificultan el control de las cargas.</li>
                <li>Asegurar todos los materiales, lonas, y elementos que puedan ser desplazados por el viento.</li>
                <li>Extremar la precaución al manipular cargas con grúas, ya que el viento puede provocar un balanceo peligroso.</li>
                <li>El Coordinador de Seguridad indicará la reanudación de los trabajos cuando las condiciones sean seguras.</li>
            </ul>
        `
    }
];

const climaticActionsData = [
    {
        title: 'Temperaturas Extremas (Altas y Bajas)',
        icon: '🌡️',
        content: `
            <p class="mb-2">La planificación de seguridad debe contemplar los fenómenos meteorológicos adversos, incluyendo temperaturas extremas, que pueden afectar significativamente las condiciones de trabajo al aire libre.</p>
            <h4 class="font-bold text-md text-blue-700 mt-4 mb-2">Temperaturas Bajas Extremas:</h4>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>10°C a 0°C:</strong> Uso obligatorio de ropa térmica adecuada y calzado con suela antideslizante. Realización de pausas regulares en áreas climatizadas.</li>
                <li><strong>0°C a -10°C:</strong> Uso de ropa térmica (guantes y gorros que cubran las orejas). Garantizar hidratación adecuada, incluso en frío. Supervisión de las condiciones del terreno. Utilización de sistemas de calefacción en áreas de trabajo fijas.</li>
                <li><strong>-10°C a -20°C:</strong> Uso de equipos de protección térmica avanzada (chaquetas aislantes, botas con forro térmico). Turnos de trabajo más cortos. Realización de revisión médica previa a trabajos prolongados en ambientes fríos.</li>
            </ul>
            <h4 class="font-bold text-md text-blue-700 mt-4 mb-2">Temperaturas Altas Extremas:</h4>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Superior a 30°C:</strong> Descansos de 10 minutos a la sombra por cada dos horas trabajadas. Hidratación constante. Uso de ropa ligera, transpirable, gorra/sombrero y protección solar. Informar de los síntomas de un golpe de calor (piel seca/sudorosa, mareos, dolor de cabeza, confusión, calambres, náuseas).</li>
                <li><strong>Alerta Naranja (33°C a 40°C):</strong> Descansos de 10 minutos a la sombra por cada hora trabajada. Reforzar hidratación. Reorganizar tareas para evitar el trabajo en horas de altas temperaturas.</li>
                <li><strong>Alerta Roja (41°C a 53°C):</strong> Descansos de 20 minutos a la sombra por cada hora trabajada. Vigilancia estricta de la hidratación del personal, incluso sin sensación de sed. Reorganizar tareas para evitar el trabajo en horas de alerta. Considerar la suspensión de actividades.</li>
                <li><strong>Superior a 42°C:</strong> Paralización de trabajos no esenciales. Permanencia en zonas frescas. Garantizar hidratación continua.</li>
            </ul>
        `
    },
    {
        title: 'Precipitaciones (Lluvia)',
        icon: '🌧️',
        content: `
            <p class="mb-2">Las lluvias pueden afectar significativamente las condiciones de trabajo y la seguridad.</p>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Débil a moderada (<15 mm/h):</strong> Uso obligatorio de calzado con suela antideslizante. Aislamiento adecuado de equipos eléctricos. Evaluar viabilidad de trabajos en altura y con riesgo eléctrico. Proveer chubasqueros y material impermeable.</li>
                <li><strong>Fuertes (15-30 mm/h):</strong> Prestar especial atención a aislamientos eléctricos y asegurar uso de calzado antideslizante. Trabajos en altura en preaviso.</li>
                <li><strong>Muy fuertes (30-60 mm/h):</strong> Suspensión de trabajos en altura. Permanencia de trabajadores bajo resguardo y en alerta ante posible evacuación.</li>
                <li><strong>Torrenciales (60-90 mm/h):</strong> Suspensión total de actividades. Buscar zonas elevadas si hay riesgo por desnivel. Revisar condiciones de zonas de trabajo antes de reanudar. Definir zonas seguras para estacionamiento de maquinaria/vehículos fuera de cauces o zonas inundables.</li>
            </ul>
        `
    },
    {
        title: 'Viento',
        icon: '🌬️',
        content: `
            <p class="mb-2">El viento puede afectar gravemente la estabilidad de estructuras y la seguridad de los trabajadores.</p>
            <ul class="list-disc list-inside space-y-1">
                <li><strong><10 km/h:</strong> No se requiere ninguna medida especial.</li>
                <li><strong>Estado de preaviso (10-25 km/h):</strong> Asegurar el flejado y apilado de materiales. Evitar presencia de personas en zonas con riesgo de caída de objetos. Reforzar tensores, contrapesos y puntos de anclaje.</li>
                <li><strong>Estado de prealarma (25-35 km/h):</strong> Paralizar trabajos en altura e izado de cargas si las condiciones afectan la seguridad. Asegurar carpas, lonas, estructuras ligeras, vallas y otros elementos móviles. No montar estructuras si el viento supera los límites de homologación.</li>
                <li><strong>35-40 km/h:</strong> Paralización de los trabajos.</li>
                <li><strong>>50 km/h:</strong> Evacuación de las zonas de trabajo.</li>
            </ul>
        `
    },
    {
        title: 'Tormentas Eléctricas',
        icon: '⚡',
        content: `
            <p class="mb-2">En caso de previsión de tormenta eléctrica inminente, es crucial tomar precauciones.</p>
            <ul class="list-disc list-inside space-y-1">
                <li>Paralizar todo trabajo en altura, en estructuras metálicas y tareas que requieran el uso de herramientas o maquinaria metálica.</li>
                <li>Los trabajadores deben resguardarse bajo techo siempre que sea posible, manteniéndose alejados de estructuras, árboles y aparatos susceptibles de atraer descargas.</li>
                <li>Está estrictamente prohibido correr, usar bicicletas, motocicletas u otros vehículos sin techo.</li>
            </ul>
        `
    },
    {
        title: 'Influencia en Trabajos Interiores y Desplazamientos (In Itinere)',
        icon: '🏠',
        content: `
            <p class="mb-2">Las condiciones climáticas también pueden afectar las actividades interiores y los desplazamientos de los trabajadores.</p>
            <h4 class="font-bold text-md text-blue-700 mt-4 mb-2">Impacto en Trabajos Interiores:</h4>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Temperaturas extremas:</strong> Pueden afectar la climatización de los edificios, creando ambientes incómodos o peligrosos (riesgo de golpe de calor o hipotermia).</li>
                <li><strong>Tormentas eléctricas y cortes de energía:</strong> Pueden causar fallos eléctricos, afectando la iluminación, ventilación o el funcionamiento de la maquinaria.</li>
                <li><strong>Lluvias intensas:</strong> Pueden provocar filtraciones de agua en edificios industriales, carpas, oficinas o almacenes, aumentando el riesgo de resbalones y caídas.</li>
            </ul>
            <h4 class="font-bold text-md text-blue-700 mt-4 mb-2">Riesgos en Desplazamientos (In Itinere):</h4>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Lluvia, nieve o hielo:</strong> Aumentan el riesgo de accidentes de tráfico al reducir la visibilidad y la adherencia en la carretera.</li>
                <li><strong>Vientos fuertes:</strong> Dificultan la conducción, especialmente para motociclistas o vehículos grandes.</li>
                <li><strong>Olas de calor o frío extremo:</strong> Pueden afectar la salud de los trabajadores durante sus trayectos, especialmente si utilizan transporte público o caminan.</li>
                <li><strong>Niebla y baja visibilidad:</strong> Dificultan la conducción, aumentando el riesgo de colisiones.</li>
            </ul>
            <h4 class="font-bold text-md text-blue-700 mt-4 mb-2">Medidas Preventivas para Trabajos Interiores y Desplazamientos:</h4>
            <ul class="list-disc list-inside space-y-1">
                <li>Asegurar una climatización y ventilación adecuadas en los espacios interiores.</li>
                <li>Revisar las instalaciones eléctricas y de drenaje para minimizar riesgos durante tormentas o lluvias intensas.</li>
                <li>Informar a los trabajadores sobre las condiciones meteorológicas y las precauciones para sus desplazamientos.</li>
                <li>Promover el teletrabajo en casos de fenómenos meteorológicos extremos que impidan el acceso seguro al lugar de trabajo.</li>
                <li>Asegurar la disponibilidad de equipos de emergencia, como generadores de energía o iluminación alternativa.</li>
            </ul>
        `
    }
];

const contactsData = [
    { name: 'ASISTENCIA EN CASO DE ACCIDENTE', icon: '🏥',
      details: `
        <p class="mb-2">En la oficina de producción, se colocará de forma bien visible para los trabajadores la dirección del centro asistencial de urgencia y teléfonos del mismo, así como los de aquellos servicios de urgencia que se consideren de importancia (ambulancia, bomberos, policía, taxis).</p>
        <p class="font-bold">El hospital más próximo para la ubicación del evento es:</p>
        <p><strong>Hospital del Bajo Cinca</strong></p>
        <p>Teléfono: <a href="tel:974472517" class="text-blue-600 hover:underline">974 47 25 17</a></p>
        <p>Dirección: C. de la Hermana Andresa, 2, 22520 Fraga, Huesca</p>
      `
    }
];

document.addEventListener('DOMContentLoaded', () => {
    const navButtons = document.querySelectorAll('.nav-btn');
    const contentSections = document.querySelectorAll('.content-section');
    const jobSelector = document.getElementById('job-selector');
    const chatbotModal = document.getElementById('chatbot-modal');
    const chatInput = document.getElementById('chat-input');
    const sendChatBtn = document.getElementById('send-chat-btn');
    const chatHistoryDiv = document.getElementById('chat-history');
    const loadingSpinner = document.getElementById('loading-spinner');
    const sendIcon = document.getElementById('send-icon');

    function updateActiveNav(targetId) {
        navButtons.forEach(btn => {
            if (btn.dataset.target === targetId) {
                btn.classList.add('active-nav');
            } else {
                btn.classList.remove('active-nav');
            }
        });
    }

    window.navigateTo = (targetId) => {
        contentSections.forEach(section => {
            section.classList.remove('active');
            if (section.id === targetId) {
                section.classList.add('active');
            }
        });
        updateActiveNav(targetId);
        window.scrollTo(0, 0);
    }
    
    navButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.dataset.target;
            navigateTo(targetId);
        });
    });
    
    function displayRisks(job) {
        const display = document.getElementById('risk-display');
        display.innerHTML = '';
        const risks = riskData[job] || [];
        if(risks.length === 0){
             display.innerHTML = `<div class="text-center p-4 bg-stone-100 rounded-lg"><p>Selecciona un puesto para ver los riesgos.</p></div>`;
             return;
        }
        risks.forEach(risk => {
            const ppeList = risk.ppe.map(item => `<li class="text-sm">${item}</li>`).join('');
            const workInstructionsList = risk.workInstructions ? risk.workInstructions.map(item => `<li class="text-sm">${item}</li>`).join('') : '<li class="text-sm">No especificado.</li>';

            const card = `
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-4">
                        <div class="flex items-start">
                            <span class="text-3xl mr-4">${risk.icon}</span>
                            <div>
                                <h4 class="font-bold text-lg">${risk.title}</h4>
                                <p class="text-stone-600 text-sm mt-1">${risk.description}</p>
                            </div>
                        </div>
                        <div class="mt-4 bg-amber-50 border border-amber-200 rounded p-3">
                            <h5 class="font-bold text-sm text-amber-800">EPIs Obligatorios:</h5>
                            <ul class="list-disc list-inside mt-1 text-amber-700">${ppeList}</ul>
                        </div>
                        <div class="mt-4 bg-emerald-50 border border-emerald-200 rounded p-3">
                            <h5 class="font-bold text-sm text-emerald-800">Instrucciones de Trabajo:</h5>
                            <ul class="list-disc list-inside mt-1 text-emerald-700">${workInstructionsList}</ul>
                        </div>
                    </div>
                </div>
            `;
            display.innerHTML += card;
        });
    }

    jobSelector.addEventListener('change', (e) => {
        displayRisks(e.target.value);
    });
    
    function populateProtocols() {
        const list = document.getElementById('protocols-list');
        list.innerHTML = '';
        protocolsData.forEach((protocol, index) => {
            const item = `
                <div class="bg-white rounded-lg shadow-md">
                    <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-bold">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${protocol.icon}</span>
                            <span>${protocol.title}</span>
                        </div>
                        <span class="transform transition-transform duration-300">▼</span>
                    </button>
                    <div class="accordion-content px-4 pb-4 text-stone-700">
                        ${protocol.content}
                    </div>
                </div>
            `;
            list.innerHTML += item;
        });

        document.querySelectorAll('.accordion-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const arrow = button.querySelector('span:last-child');
                button.parentElement.classList.toggle('open');
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    arrow.style.transform = 'rotate(180deg)';
                }
            });
        });
    }

    function populateClimaticActions() {
        const list = document.getElementById('climatic-actions-list');
        list.innerHTML = '';
        climaticActionsData.forEach((action, index) => {
            const item = `
                <div class="bg-white rounded-lg shadow-md">
                    <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left font-bold">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${action.icon}</span>
                            <span>${action.title}</span>
                        </div>
                        <span class="transform transition-transform duration-300">▼</span>
                    </button>
                    <div class="accordion-content px-4 pb-4 text-stone-700">
                        ${action.content}
                    </div>
                </div>
            `;
            list.innerHTML += item;
        });

        document.querySelectorAll('#climatic-actions-list .accordion-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const arrow = button.querySelector('span:last-child');
                button.parentElement.classList.toggle('open');
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    arrow.style.transform = 'rotate(180deg)';
                }
            });
        });
    }

    function populateContacts() {
        const list = document.getElementById('contacts-list');
        list.innerHTML = '';
        contactsData.forEach(contact => {
            const item = `
                 <div class="bg-white p-4 rounded-lg shadow flex flex-col">
                    <div class="flex items-center mb-2">
                         <span class="text-3xl mr-4">${contact.icon}</span>
                        <div>
                            <h3 class="font-bold">${contact.name}</h3>
                        </div>
                    </div>
                    <div class="text-stone-600 text-sm">
                        ${contact.details}
                    </div>
                </div>
            `;
            list.innerHTML += item;
        });
    }

    window.showEmergencyProtocol = () => {
        document.getElementById('emergency-modal').classList.remove('hidden');
    }

    window.closeEmergencyProtocol = () => {
        document.getElementById('emergency-modal').classList.add('hidden');
    }

    function setupHeatRisk() {
        const heatRiskContainer = document.getElementById('heat-risk-container');
        const heatRiskLevel = document.getElementById('heat-risk-level');
        const heatRiskDescription = document.getElementById('heat-risk-description');
        const heatLevelText = document.getElementById('heat-level-text');
        
        const heatIndex = 35; 
        
        let level, description, color, recommendations;

        if (heatIndex < 33) {
            level = 'PRECAUCIÓN';
            description = 'Posible fatiga con exposición prolongada.';
            color = 'bg-yellow-500'; 
        } else if (heatIndex >= 33 && heatIndex <= 40) {
            level = 'PRECAUCIÓN EXTREMA';
            description = 'Insolación y calambres posibles.';
            color = 'bg-orange-500';
        } else if (heatIndex >= 41 && heatIndex <= 53) {
            level = 'PELIGRO';
            description = 'Insolación y golpe de calor muy probables.';
            color = 'bg-red-600';
        } else {
            level = 'PELIGRO EXTREMO';
            description = 'Golpe de calor inminente.';
            color = 'bg-purple-800';
        }

        heatRiskContainer.className = `p-4 rounded-lg text-white text-center flex flex-col items-center ${color}`;
        heatRiskLevel.textContent = level;
        heatRiskDescription.textContent = description;
        heatLevelText.textContent = `${heatIndex}°`;
        
        const heatRiskChartCtx = document.getElementById('heatRiskChart').getContext('2d');
        const chartData = {
            datasets: [{
                data: [heatIndex, 54 - heatIndex], 
                backgroundColor: ['#FFFFFF', 'rgba(255, 255, 255, 0.3)'],
                borderWidth: 0,
                circumference: 180,
                rotation: 270,
            }]
        };

        new Chart(heatRiskChartCtx, {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    tooltip: { enabled: false },
                    legend: { display: false }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    }

    // Chatbot functions
    window.showChatbotModal = () => {
        chatbotModal.classList.remove('hidden');
        chatInput.focus();
    }

    window.closeChatbotModal = () => {
        chatbotModal.classList.add('hidden');
    }

    const appendMessage = (sender, text) => {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', sender);
        messageDiv.textContent = text;
        chatHistoryDiv.appendChild(messageDiv);
        chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight; // Scroll to bottom
    };

    const sendMessage = async () => {
        const userMessage = chatInput.value.trim();
        if (userMessage === '') return;

        appendMessage('user', userMessage);
        chatInput.value = '';
        
        sendIcon.classList.add('hidden');
        loadingSpinner.classList.remove('hidden');
        sendChatBtn.disabled = true;

        try {
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: `Actúa como un experto en seguridad laboral para el festival Monegros 2025. Responde a las preguntas de los trabajadores de forma clara y concisa, basándote en principios generales de prevención de riesgos laborales. Mi pregunta es: ${userMessage}` }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const aiResponse = result.candidates[0].content.parts[0].text;
                appendMessage('ai', aiResponse);
            } else {
                appendMessage('ai', 'Lo siento, no pude obtener una respuesta en este momento. Por favor, intenta de nuevo.');
            }
        } catch (error) {
            console.error('Error al llamar a la API de Gemini:', error);
            appendMessage('ai', 'Hubo un error al conectar con el asistente. Por favor, revisa tu conexión e inténtalo de nuevo.');
        } finally {
            loadingSpinner.classList.add('hidden');
            sendIcon.classList.remove('hidden');
            sendChatBtn.disabled = false;
        }
    };

    sendChatBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    displayRisks('general');
    populateProtocols();
    populateClimaticActions(); // Call the new function
    populateContacts();
    setupHeatRisk();
});
</script>
</body>
</html>
�
